local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local Debris = game:GetService("Debris")

local player = Players.LocalPlayer
local camera = workspace.CurrentCamera
local char = player.Character or player.CharacterAdded:Wait()
local humanoid = char:WaitForChild("Humanoid")
local hrp = char:WaitForChild("HumanoidRootPart")

local startPosition = Vector3.new(123.27, 4.09, -320.79)
local reachDistance = 1.3

local cameraRadius = 10
local cameraHeight = 5
local cameraSpeed = 1.2

local path = {
	{pos = Vector3.new(123.27, 4.09, -320.79), speed = 16},
	{pos = Vector3.new(126.00, 4.09, -319.20), speed = 16},
	{pos = Vector3.new(129.40, 4.09, -317.60), speed = 16},
	{pos = Vector3.new(132.80, 4.09, -315.90), speed = 24},
	{pos = Vector3.new(136.10, 4.09, -314.30), speed = 24},
	{pos = Vector3.new(139.50, 4.09, -312.80), speed = 16},
}

local running = false
local originCFrame
local cameraConn
local camAngle = 0
local oldCamType
local oldCamSubject

local function teleport(cf)
	humanoid:ChangeState(Enum.HumanoidStateType.Physics)
	task.wait(0.05)
	hrp.CFrame = cf
	task.wait(0.05)
	humanoid:ChangeState(Enum.HumanoidStateType.Running)
end

local function walkReal(targetPos, speed)
	humanoid.WalkSpeed = speed or 16
	while running and (hrp.Position - targetPos).Magnitude > reachDistance do
		local dir = targetPos - hrp.Position
		dir = Vector3.new(dir.X, 0, dir.Z)
		if dir.Magnitude > 0 then
			humanoid:Move(dir.Unit, true)
		end
		RunService.RenderStepped:Wait()
	end
	humanoid:Move(Vector3.zero, true)
end

local function startCamera()
	oldCamType = camera.CameraType
	oldCamSubject = camera.CameraSubject
	camera.CameraType = Enum.CameraType.Scriptable
	camAngle = 0
	cameraConn = RunService.RenderStepped:Connect(function(dt)
		if not running then return end
		camAngle += dt * cameraSpeed
		local offset = Vector3.new(
			math.cos(camAngle) * cameraRadius,
			cameraHeight,
			math.sin(camAngle) * cameraRadius
		)
		camera.CFrame = CFrame.new(hrp.Position + offset, hrp.Position)
	end)
end

local function stopCamera()
	if cameraConn then
		cameraConn:Disconnect()
		cameraConn = nil
	end
	camera.CameraType = oldCamType or Enum.CameraType.Custom
	camera.CameraSubject = oldCamSubject or humanoid
end

local function startReplay()
	if running then return end
	running = true
	originCFrame = hrp.CFrame
	teleport(CFrame.new(startPosition))
	startCamera()

	task.spawn(function()
		while running do
			for _, step in ipairs(path) do
				if not running then break end
				walkReal(step.pos, step.speed)
			end
			task.wait(0.1)
		end
		stopCamera()
	end)
end

local function stopReplay()
	if not running then return end
	running = false
	humanoid:Move(Vector3.zero, true)
	stopCamera()
	if originCFrame then
		task.wait(0.1)
		teleport(originCFrame)
	end
end

pcall(function()
	local old = player.PlayerGui:FindFirstChild("ReplayGui")
	if old then old:Destroy() end
end)

local gui = Instance.new("ScreenGui", player.PlayerGui)
gui.Name = "ReplayGui"
gui.ResetOnSpawn = false

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0,260,0,170)
frame.Position = UDim2.new(0.02,0,0.4,0)
frame.BackgroundColor3 = Color3.fromRGB(120,25,25)
frame.Active = true
frame.Draggable = true
frame.BorderSizePixel = 0
Instance.new("UICorner", frame).CornerRadius = UDim.new(0,16)

local gradient = Instance.new("UIGradient", frame)
gradient.Color = ColorSequence.new{
	ColorSequenceKeypoint.new(0, Color3.fromRGB(170,30,30)),
	ColorSequenceKeypoint.new(1, Color3.fromRGB(20,120,60))
}
gradient.Rotation = 45

task.spawn(function()
	while frame.Parent do
		gradient.Rotation += 1
		task.wait(0.05)
	end
end)

local stroke = Instance.new("UIStroke", frame)
stroke.Thickness = 2
stroke.Color = Color3.new(1,1,1)
stroke.Transparency = 0.4

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1,0,0,40)
title.Position = UDim2.new(0,0,0,8)
title.BackgroundTransparency = 1
title.Text = "üéÑ Evento de Natal ! ‚ùÑÔ∏è"
title.Font = Enum.Font.GothamBold
title.TextSize = 18
title.TextColor3 = Color3.new(1,1,1)

local function createButton(text, posY, color)
	local btn = Instance.new("TextButton", frame)
	btn.Size = UDim2.new(0.88,0,0,38)
	btn.Position = UDim2.new(0.06,0,posY,0)
	btn.Text = text
	btn.Font = Enum.Font.GothamBold
	btn.TextSize = 15
	btn.TextColor3 = Color3.new(1,1,1)
	btn.BackgroundColor3 = color
	btn.AutoButtonColor = false
	btn.BorderSizePixel = 0
	Instance.new("UICorner", btn).CornerRadius = UDim.new(0,12)
	return btn
end

local startBtn = createButton("üéÅ INICIAR", 0.38, Color3.fromRGB(40,170,90))
local stopBtn  = createButton("üõë PARAR",   0.65, Color3.fromRGB(200,60,60))

startBtn.MouseButton1Click:Connect(startReplay)
stopBtn.MouseButton1Click:Connect(stopReplay)

task.spawn(function()
	while frame.Parent do
		local snow = Instance.new("TextLabel", frame)
		snow.Text = "‚ùÑ"
		snow.BackgroundTransparency = 1
		snow.TextColor3 = Color3.new(1,1,1)
		snow.TextSize = math.random(12,20)
		snow.Position = UDim2.new(math.random(),0,-0.1,0)
		snow.Size = UDim2.new(0,24,0,24)

		TweenService:Create(snow, TweenInfo.new(math.random(3,5)), {
			Position = UDim2.new(snow.Position.X.Scale,0,1.2,0),
			TextTransparency = 1
		}):Play()

		Debris:AddItem(snow,5)
		task.wait(0.25)
	end
end)
